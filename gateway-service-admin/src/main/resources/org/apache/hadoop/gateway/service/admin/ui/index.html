<!--/**-->
<!--* Licensed to the Apache Software Foundation (ASF) under one-->
<!--* or more contributor license agreements.  See the NOTICE file-->
<!--* distributed with this work for additional information-->
<!--* regarding copyright ownership.  The ASF licenses this file-->
<!--* to you under the Apache License, Version 2.0 (the-->
<!--* "License"); you may not use this file except in compliance-->
<!--* with the License.  You may obtain a copy of the License at-->
<!--*-->
<!--*     http://www.apache.org/licenses/LICENSE-2.0-->
<!--*-->
<!--* Unless required by applicable law or agreed to in writing, software-->
<!--* distributed under the License is distributed on an "AS IS" BASIS,-->
<!--* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.-->
<!--* See the License for the specific language governing permissions and-->
<!--* limitations under the License.-->
<!--*/-->
<html>
<head>
    <title>Knox Dashboard</title>
	<style>
		html, body, p, div, span, h1, h2, h3, h4, h5 {
			margin: 0px;
			padding: 0px;
		}
		a{
			text-decoration: none;
			color:inherit;
		}
		a:hover {
			
		}
		header {
			background-color:limegreen;
			height: 45px;
			color:white;
			box-shadow: 0px 5px 20px black;
		}
		header > h1 {
			max-height: inherit;
			padding:10px;
			margin:10px;
		}
		#content {
			margin: 30px auto;
			border-radius: 10px;
			max-width: 80%;
			min-width: 80%;
			min-height: 100%;
		}
		#content > h1, h2, h3, h4, h5, h6 {
			text-align: center;
		}
		body {
			background-color: rgb(50, 50, 50);
			color:white;
			font-family: sans-serif;
		}
		.topology-container {
			padding: 20px 20px;
			margin: 20px auto;
			background-color:rgb(75,75,75);
			min-width: 20px;
			min-height: 20px;
			border-radius: 10px;
			box-shadow: 5px 5px 20px rgb(20, 20, 20);
		}
		.topology-container > p {
			margin: 10px;
			padding: 10px;
			text-align: center;
		}
	</style>
</head>

	<header>
		<a href="index.html"><h1>Apache Knox</h1></a>
	</header>
    <body>
		<div id="content">
			<h2>Dashboard</h2>
			<div class="topology-container">
				<h3>Topologies</h3>
				<ul id="topologies-list">
					<li></li>
				</ul>
			</div>
			<div class="topology-container">
				<h3>Topology Info</h3>
				</br>
				<p>Topology information will appear here.</p>
				<ul id="topologies-list">
				</ul>
			</div>
			
		</div>
    </body>
	<script>
		var topList = document.getElementById("topologies-list");
		var ulItem = document.createElement("li");
		makeGetRequest("https://localhost:8443/gateway/admin/api/v1/topologies", makeUL);
		//makeGetRequest("http://127.0.0.1:51850/index.html", makeUL);
		
		function makeGetRequest(url, callback) {
			var request = new XMLHttpRequest();
			request.withCredentials = true;
			request.onreadystatechange = function(){callback(request);};
			request.open("GET", url, true);
			console.log(btoa("admin:admin-password"));
			request.setRequestHeader("Authorization", "Basic " + btoa("admin:admin-password"));
			request.setRequestHeader("Accept", "application/json");
			request.send();
		}
		
		function makeUL(request) {
			console.log("makeUL called " + request.readyState + " ayy");
			while(topList.firstChild) {
				topList.removeChild(topList.firstChild);
			}
			if(request.readyState == 4) {
				var js = request.response.topologies;
				console.log(request.response);
				console.log(JSON.parse(request.response));
				var js2 = JSON.parse(request.response);
				js2 = js2.topologies.topology;
				for(j = 0; j < js2.length; j++) {
					var e = document.createElement("li")
					var link = document.createElement("a");
					link.setAttribute("href", js2[j].href)
					link.innerHTML = js2[j].name;
					e.appendChild(link);
					topList.appendChild(e);
				}
			} else {
				var elem = document.createElement("ul");
				elem.innerHTML = "Loading Topologies...";
				topList.appendChild(elem);
			}
		}
				
		function getBaseURI(){
			var uri = "";
			uri += location.protocol + "//";
			uri += location.hostname + ":";
			uri += location.port;
			
			var paths = location.pathname.split("/");				
			return uri;
		}
	</script>
</html>